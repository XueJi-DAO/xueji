# DSL 开发

## 关于 DSL

**领域特定语言**(DSL, Domain Specific Language) 的缩写；与 DSL 相对的是通用编程语言 (GPL, General Purpose Language)，如 Java、Python 以及 C++ 语言等。通用的计算机编程语言是可以用来编写任意计算机程序的，并且能表达任何的可被计算的逻辑，同时也是**图灵完备**的。但是在里所说的 DSL 并不是图灵完备的，它们的表达能力有限，只是在特定领域解决特定任务的。DSL 通过在表达能力上做的妥协换取在某一领域内的高效。

DSL (SQL/HTML/CSS) > Shell > Python/js > Go/Java > C/C++/Rust > LLVM IR > 汇编机器码

## 定位

开发一种用于知识表示协作的专用语言，介于编程语言、自然语言之间，目的在于与系统服务进行高效的人机交互，具有相对固定的语法，以易用性为重心，同时方便专业用户自定义复杂应用。

Html/CSS(外部 DSL)<=JQuery(内部 DSL)<= Js => Typescript; 面向程序员的准确语言，基于库+引擎 (C++)  
Magic 语言：面向专业用户简易高效的语言，替代+扩展+内嵌已有语言，必须基于自己开发的解析引擎+后台功能 (C++)

## 功能

- 文档处理、知识表示、数据可视化、交互指令、表示语法 + 传输语法

- 空间、域、类、对象、函数、变量、数据类型、注解、包、模块、闭包、运算符、逻辑控制...

- 交互式：npm init

- 语法帮助：show how done|to

## 特性

自定义、自动补全、修正、声明式 + 命令式、内嵌其他语言

## 实现

- 初步基于 Bison++ 解析器生成器进行开发。
- 通过 EBNF 定义语法

### 语法说明

语法特性+标识符

## 学习

LLVM 编译一个源文件的过程：预处理 -> 词法分析 -> Token -> 语法分析 -> AST -> 代码生成 -> LLVM IR -> 优化 -> 生成汇编代码 -> Link -> 目标文件

- 词法分析（lexical analysis）是计算机科学中将字符序列转换为单词（Token）序列的过程。进行词法分析的程序或者函数叫作词法分析器（Lexical analyzer，简称 Lexer），也叫扫描器（Scanner）。

- 语法分析（英：Syntactic analysis，也叫 Parsing）是根据某种给定的形式文法对由单词序列（如英语单词序列）构成的输入文本进行分析并确定其语法结构的一种过程。

- 语法分析器:的任务主要是确定是否可以以及如何从语法的起始符号推导出输入符号串（输入文本），主要可以通过两种方式完成：自顶向下分析、自底向上分析。进行语法检查、并构建由输入的单词组成的数据- 结构（一般是语法分析树、抽象语法树等层次化的数据结构）。通常使用一个独立的词法分析器从输入字符流中分离出一个个的“单词”，并将单词流作为其输入。语法分析器可以手工编写，也可以- 使用工具（半）自动生成。

- 抽象语法树（Abstract Syntax Tree，AST），或简称语法树（Syntax tree），是源代码语法结构的一种抽象表示。它以树状的形式表现编程语言的语法结构，树上的每个节点都表示源代码中的一种结构。

- Lex 是一个产生词法分析器，Lex 读进一个代表词法分析器规则的输入字符串流，然后输出以 C 语言实做的词法分析器源代码。

- 分析程序生成器(parser generator)，所产生的解析器需要词法分析器配合。

  YACC (Yet Another Compiler Compiler)，是一个经典的生成语法分析器的工具。  
  Bison 则是 GNU 版本的 YACC。  
  lalrpop：Rust 的 LR(1) 解析器生成器  
  Lemon 是一个 LALR(1)文法分析器生成工具。虽然它是 SQLite 作者针对 SQLite 写的一个分析器生成工具，但是它与 bison 和 yacc 类似，是一个可以独立于 SQLite 使用的开源的分析器生成工具。  
  巴科斯范式 以美国人巴科斯(Backus)和丹麦人诺尔(Naur)的名字命名的一种形式化的语法表示方法，用来描述语法的一种形式体系，是一种典型的元语言。又称巴科斯-诺尔形式(Backus-Naur form)。它不仅能严格地表示语法规则，而且所描述的语法是与上下文无关的。

- **传统的编译器架构：** 高级语言源码-->Frontend:前端(词法、语法、语义分析、生成中间代码)-->Optimizer:优化器(中间代码优化)-->Backend:后端(生成机器码)。

- LLVM 是构架编译器(compiler)的框架系统。不同的前端后端使用统一的中间代码 LLVM Intermediate Representation (LLVM IR)。如果需要支持一种新的编程语言，那么只需要实现一个新的前端，如果需要支持一种新的硬件设备，那么只需要实现一个新的后端。

## 参考

- https://gnuu.org/2009/09/18/writing-your-own-toy-compiler/
- 上文翻译：https://blog.csdn.net/lmk2008/article/details/25891427
- 实现一个简单的编译器：https://github.com/shdxiang/xy-compiler
- ABnf 语法描述: https://zhuanlan.zhihu.com/p/364844806
